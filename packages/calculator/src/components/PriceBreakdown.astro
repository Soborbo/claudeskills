---
/**
 * PriceBreakdown - Price Result Display
 *
 * Shows calculated price with breakdown items.
 */

import type { PriceResult, PriceBreakdownItem } from '../types';

export interface Props {
  /** Price result from calculatePrice() */
  result: PriceResult;
  /** Show breakdown details */
  showBreakdown?: boolean;
  /** Show price range */
  showRange?: boolean;
  /** Compact mode */
  compact?: boolean;
  /** Additional classes */
  class?: string;
}

const {
  result,
  showBreakdown = true,
  showRange = true,
  compact = false,
  class: className,
} = Astro.props;

const { total, formatted, breakdown, range, currency } = result;

function getItemIcon(type: PriceBreakdownItem['type']): string {
  switch (type) {
    case 'base':
      return 'üè†';
    case 'multiplier':
      return '√ó';
    case 'addon':
      return '+';
    case 'discount':
      return '‚àí';
    default:
      return '‚Ä¢';
  }
}
---

<div class:list={['price-breakdown', { 'price-breakdown--compact': compact }, className]}>
  {/* Main price */}
  <div class="text-center mb-6">
    {range && showRange ? (
      <>
        <p class="text-sm text-gray-500 mb-1">Becs√ºlt √°r</p>
        <p class="text-3xl md:text-4xl font-bold text-gray-900">
          {range.formatted}
        </p>
        <p class="text-sm text-gray-500 mt-1">
          (¬±15% elt√©r√©s lehets√©ges)
        </p>
      </>
    ) : (
      <>
        <p class="text-sm text-gray-500 mb-1">Becs√ºlt √°r</p>
        <p class="text-3xl md:text-4xl font-bold text-primary-600">
          {formatted}
        </p>
      </>
    )}
  </div>

  {/* Breakdown */}
  {showBreakdown && breakdown.length > 0 && (
    <div class="border-t border-gray-200 pt-4">
      <h3 class="text-sm font-medium text-gray-700 mb-3">√År √∂sszet√©tele</h3>

      <ul class="space-y-2">
        {breakdown.map((item) => (
          <li class="flex items-center justify-between text-sm">
            <span class="flex items-center gap-2 text-gray-600">
              <span class="w-5 text-center text-gray-400">{getItemIcon(item.type)}</span>
              {item.label}
            </span>
            <span
              class:list={[
                'font-medium',
                {
                  'text-gray-900': item.type === 'base',
                  'text-green-600': item.type === 'discount',
                  'text-gray-700': item.type !== 'base' && item.type !== 'discount',
                },
              ]}
            >
              {item.type === 'discount' ? '‚àí' : ''}
              {new Intl.NumberFormat('hu-HU', {
                style: 'currency',
                currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
              }).format(Math.abs(item.amount))}
            </span>
          </li>
        ))}
      </ul>

      {/* Total line */}
      <div class="mt-4 pt-3 border-t border-gray-200 flex items-center justify-between">
        <span class="font-medium text-gray-900">√ñsszesen</span>
        <span class="text-lg font-bold text-primary-600">{formatted}</span>
      </div>
    </div>
  )}

  {/* Disclaimer */}
  <p class="mt-4 text-xs text-gray-500 text-center">
    A v√©gleges √°r a helysz√≠ni felm√©r√©s ut√°n ker√ºl meghat√°roz√°sra.
  </p>
</div>

<style>
  .price-breakdown {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
  }

  .price-breakdown--compact {
    padding: 1rem;
  }

  .price-breakdown--compact .text-3xl {
    font-size: 1.5rem;
  }
</style>
