# Accessibility (a11y)

## WCAG 2.1 AA Compliance (Minimum)

Every site must meet these requirements.

## Color Contrast

| Element | Minimum Ratio |
|---------|---------------|
| Body text | 4.5:1 |
| Large text (18px+ bold, 24px+) | 3:1 |
| UI components | 3:1 |
| Focus indicators | 3:1 |

Test with: Chrome DevTools, WebAIM Contrast Checker

## Keyboard Navigation

```css
/* Visible focus states */
:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* Remove default only if custom exists */
:focus:not(:focus-visible) {
  outline: none;
}
```

All interactive elements must be:
- Focusable via Tab
- Activatable via Enter/Space
- In logical order

## Skip Link

First element in body:

```astro
<a 
  href="#main-content" 
  class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 
         focus:z-50 focus:bg-white focus:px-4 focus:py-2 focus:text-primary"
>
  Skip to main content
</a>

<!-- Later in page -->
<main id="main-content" tabindex="-1">
```

## Semantic HTML

```astro
<header>
  <nav aria-label="Main navigation">
    <ul role="list">
      <li><a href="/">Home</a></li>
    </ul>
  </nav>
</header>

<main id="main-content">
  <article>
    <h1>Page Title</h1>
    <section aria-labelledby="benefits-heading">
      <h2 id="benefits-heading">Benefits</h2>
    </section>
  </article>
</main>

<footer>
  <nav aria-label="Footer navigation">
</footer>
```

## Heading Hierarchy

- ONE `<h1>` per page
- Never skip levels (h1 â†’ h3)
- Use for structure, not styling

## Images

```astro
<!-- Informative image -->
<img src="..." alt="Team of movers loading a van" />

<!-- Decorative image -->
<img src="..." alt="" role="presentation" />

<!-- Complex image -->
<figure>
  <img src="chart.png" alt="Sales growth chart" aria-describedby="chart-desc" />
  <figcaption id="chart-desc">
    Sales increased 45% from Q1 to Q4 2024.
  </figcaption>
</figure>
```

## Forms

```astro
<form>
  <div class="form-group">
    <label for="name">
      Full Name
      <span class="text-red-500" aria-hidden="true">*</span>
      <span class="sr-only">(required)</span>
    </label>
    <input 
      type="text" 
      id="name" 
      name="name"
      required
      aria-required="true"
      autocomplete="name"
    />
  </div>
  
  <div class="form-group" role="group" aria-labelledby="phone-label">
    <span id="phone-label">Phone Number</span>
    <input 
      type="tel" 
      id="phone"
      aria-describedby="phone-hint"
      autocomplete="tel"
    />
    <span id="phone-hint" class="text-sm text-gray-500">
      Format: +44 XXX XXX XXXX
    </span>
  </div>
  
  <!-- Error state -->
  <div class="form-group">
    <label for="email">Email</label>
    <input 
      type="email" 
      id="email"
      aria-invalid="true"
      aria-describedby="email-error"
    />
    <span id="email-error" class="text-red-500" role="alert">
      Please enter a valid email address
    </span>
  </div>
</form>
```

## Buttons vs Links

```astro
<!-- Link: navigates to URL -->
<a href="/contact">Contact Us</a>

<!-- Button: performs action -->
<button type="button" onclick="openModal()">
  Get Quote
</button>

<!-- NEVER -->
<div onclick="...">Click me</div>
<a href="#" onclick="...">Click me</a>
```

## Mobile Menu (Focus Trap)

```typescript
// src/lib/focus-trap.ts
export function trapFocus(element: HTMLElement) {
  const focusable = element.querySelectorAll(
    'a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])'
  );
  const first = focusable[0] as HTMLElement;
  const last = focusable[focusable.length - 1] as HTMLElement;
  
  element.addEventListener('keydown', (e) => {
    if (e.key !== 'Tab') return;
    
    if (e.shiftKey && document.activeElement === first) {
      last.focus();
      e.preventDefault();
    } else if (!e.shiftKey && document.activeElement === last) {
      first.focus();
      e.preventDefault();
    }
  });
}
```

## Reduced Motion

```css
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

## Screen Reader Utilities

```css
/* Visually hidden but accessible */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Visible when focused */
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}
```

## Checklist

- [ ] Skip link present
- [ ] Heading hierarchy correct
- [ ] All images have alt text
- [ ] Color contrast meets 4.5:1
- [ ] Focus states visible
- [ ] Keyboard navigation works
- [ ] Forms have labels
- [ ] Error messages announced
- [ ] Mobile menu has focus trap
- [ ] `prefers-reduced-motion` respected
- [ ] Language declared: `<html lang="en">`
- [ ] Page titles unique and descriptive
